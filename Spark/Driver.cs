using System;
using System.Diagnostics;
using System.Runtime.InteropServices;
using Microsoft.Win32;

namespace Spark
{
	// Token: 0x0200000A RID: 10
	internal class Driver
	{
		// Token: 0x06000031 RID: 49
		[DllImport("C:\\Windows\\File Cache\\DLL.dll", CharSet = CharSet.Unicode, EntryPoint = "?SendIOCTL@Export@SparkDLL@@QAEXH@Z")]
		public static extern void SendIOCTL(int colour);

		// Token: 0x06000032 RID: 50
		[DllImport("C:\\Windows\\File Cache\\DLL.dll", CharSet = CharSet.Unicode, EntryPoint = "?Load@Export@SparkDLL@@QAEXXZ")]
		public static extern void Load();

		// Token: 0x06000033 RID: 51
		[DllImport("kernel32.dll", SetLastError = true)]
		private static extern bool Wow64DisableWow64FsRedirection(ref IntPtr ptr);

		// Token: 0x06000034 RID: 52 RVA: 0x00002C30 File Offset: 0x00000E30
		public static void Unblock()
		{
			IntPtr zero = IntPtr.Zero;
			Driver.Wow64DisableWow64FsRedirection(ref zero);
			new Process
			{
				StartInfo = new ProcessStartInfo(Variables.windir + "\\System32\\bcdedit.exe", " -set nointegritychecks on")
				{
					UseShellExecute = false,
					RedirectStandardInput = true,
					RedirectStandardOutput = false,
					CreateNoWindow = true
				}
			}.Start();
			new Process
			{
				StartInfo = new ProcessStartInfo(Variables.windir + "\\System32\\bcdedit.exe", " -set testsigning on")
				{
					UseShellExecute = false,
					RedirectStandardInput = true,
					RedirectStandardOutput = false,
					CreateNoWindow = true
				}
			}.Start();
		}

		// Token: 0x06000035 RID: 53 RVA: 0x00002CD8 File Offset: 0x00000ED8
		public static void Register()
		{
			string value = "\\??\\" + Variables.FilePath + "\\Driver.sys";
			string value2 = "Driver";
			RegistryKey registryKey = Registry.LocalMachine.CreateSubKey("SYSTEM\\CurrentControlSet\\Services\\Driver");
			registryKey.SetValue("ImagePath", value, RegistryValueKind.ExpandString);
			registryKey.Close();
			RegistryKey registryKey2 = Registry.LocalMachine.CreateSubKey("SYSTEM\\CurrentControlSet\\Services\\Driver");
			registryKey2.SetValue("DisplayName", value2, RegistryValueKind.String);
			registryKey2.Close();
			RegistryKey registryKey3 = Registry.LocalMachine.CreateSubKey("SYSTEM\\CurrentControlSet\\Services\\Driver");
			registryKey3.SetValue("Start", 3, RegistryValueKind.DWord);
			registryKey3.Close();
			RegistryKey registryKey4 = Registry.LocalMachine.CreateSubKey("SYSTEM\\CurrentControlSet\\Services\\Driver");
			registryKey4.SetValue("Type", 1, RegistryValueKind.DWord);
			registryKey4.Close();
			RegistryKey registryKey5 = Registry.LocalMachine.CreateSubKey("SYSTEM\\CurrentControlSet\\Services\\Driver");
			registryKey5.SetValue("ErrorControl", 1, RegistryValueKind.DWord);
			registryKey5.Close();
		}
	}
}
